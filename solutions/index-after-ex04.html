<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini CLI Mario</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #1a1a2e;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Courier New', monospace;
        }
        canvas {
            border: 4px solid #e94560;
            border-radius: 8px;
            box-shadow: 0 0 30px rgba(233, 69, 96, 0.3);
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="500"></canvas>
    <script>
// ======== CONSTANTS ========
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const GRAVITY = 0.6;
const JUMP_FORCE = -12;
const PLAYER_SPEED = 5;
const FRICTION = 0.8;

// ======== GAME STATE ========
let gameOver = false;
let gameWon = false;
let frameCount = 0;

// ======== PLAYER ========
let player = {
    x: 100,
    y: 300,
    width: 32,
    height: 32,
    velX: 0,
    velY: 0,
    speed: PLAYER_SPEED,
    jumping: false,
    grounded: false,
    color: '#e94560'
};

// ======== PLATFORMS ========
const platforms = [
    { x: 0,   y: 460, width: 800, height: 40, color: '#4a752c' },
    { x: 150, y: 370, width: 120, height: 20, color: '#8B4513' },
    { x: 350, y: 300, width: 120, height: 20, color: '#8B4513' },
    { x: 550, y: 230, width: 120, height: 20, color: '#8B4513' },
    { x: 200, y: 160, width: 120, height: 20, color: '#8B4513' }
];

// ======== COINS ========
let score = 0;
let coins = [
    { x: 195, y: 335, width: 16, height: 16, collected: false, baseY: 335 },
    { x: 395, y: 265, width: 16, height: 16, collected: false, baseY: 265 },
    { x: 595, y: 195, width: 16, height: 16, collected: false, baseY: 195 },
    { x: 245, y: 125, width: 16, height: 16, collected: false, baseY: 125 },
    { x: 650, y: 425, width: 16, height: 16, collected: false, baseY: 425 }
];

// ======== ENEMY ========
let enemy = {
    x: 500,
    y: 430,
    width: 32,
    height: 30,
    velX: 2,
    minX: 400,
    maxX: 700,
    alive: true,
    color: '#2ecc71'
};

// ======== PARTICLES ========
let particles = [];

// ======== INPUT ========
const keys = {};
document.addEventListener('keydown', (e) => {
    keys[e.code] = true;
    if (['Space', 'ArrowUp', 'ArrowDown'].includes(e.code)) {
        e.preventDefault();
    }
    if (e.code === 'KeyR') {
        restartGame();
    }
});
document.addEventListener('keyup', (e) => {
    keys[e.code] = false;
});

// ======== COLLISION ========
function checkCollision(rect1, rect2) {
    return rect1.x < rect2.x + rect2.width &&
           rect1.x + rect1.width > rect2.x &&
           rect1.y < rect2.y + rect2.height &&
           rect1.y + rect1.height > rect2.y;
}

// ======== CLOUDS ========
const clouds = [
    { x: 100, y: 60, size: 40 },
    { x: 300, y: 90, size: 30 },
    { x: 550, y: 50, size: 50 },
    { x: 700, y: 100, size: 35 }
];

// ======== RESTART ========
function restartGame() {
    player.x = 100;
    player.y = 300;
    player.velX = 0;
    player.velY = 0;
    player.jumping = false;
    player.grounded = false;
    score = 0;
    for (const coin of coins) {
        coin.collected = false;
    }
    enemy.x = 500;
    enemy.y = 430;
    enemy.velX = 2;
    enemy.alive = true;
    particles = [];
    gameOver = false;
    gameWon = false;
    frameCount = 0;
}

// ======== UPDATE ========
function update() {
    if (gameOver || gameWon) return;

    frameCount++;

    // Horizontal movement
    if (keys['ArrowLeft']) {
        player.velX = -player.speed;
    } else if (keys['ArrowRight']) {
        player.velX = player.speed;
    } else {
        player.velX *= FRICTION;
        if (Math.abs(player.velX) < 0.1) player.velX = 0;
    }

    // Apply gravity
    player.velY += GRAVITY;

    // Jump
    if ((keys['Space'] || keys['ArrowUp']) && player.grounded) {
        player.velY = JUMP_FORCE;
        player.jumping = true;
        player.grounded = false;
    }

    // Apply velocity
    player.x += player.velX;
    player.y += player.velY;

    // Boundary checking
    if (player.x < 0) player.x = 0;
    if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;

    // Platform collision
    player.grounded = false;
    for (const platform of platforms) {
        if (checkCollision(player, platform)) {
            if (player.velY > 0 && player.y + player.height - player.velY <= platform.y) {
                player.y = platform.y - player.height;
                player.velY = 0;
                player.grounded = true;
                player.jumping = false;
            }
            else if (player.velY < 0 && player.y - player.velY >= platform.y + platform.height) {
                player.y = platform.y + platform.height;
                player.velY = 0;
            }
        }
    }

    // Keep player in bounds (vertical)
    if (player.y + player.height > canvas.height) {
        player.y = canvas.height - player.height;
        player.velY = 0;
        player.grounded = true;
        player.jumping = false;
    }

    // Coin collection
    for (const coin of coins) {
        if (!coin.collected && checkCollision(player, coin)) {
            coin.collected = true;
            score++;
            for (let i = 0; i < 8; i++) {
                particles.push({
                    x: coin.x + coin.width / 2,
                    y: coin.y + coin.height / 2,
                    velX: (Math.random() - 0.5) * 4,
                    velY: (Math.random() - 0.5) * 4,
                    life: 30,
                    color: '#FFD700'
                });
            }
        }
        if (!coin.collected) {
            coin.y = coin.baseY + Math.sin(frameCount * 0.05 + coins.indexOf(coin)) * 5;
        }
    }

    // Enemy patrol
    if (enemy.alive) {
        enemy.x += enemy.velX;
        if (enemy.x <= enemy.minX || enemy.x + enemy.width >= enemy.maxX) {
            enemy.velX *= -1;
        }
        // Bobbing animation for enemy
        enemy.y = 430 + Math.sin(frameCount * 0.1) * 2;

        // Player-enemy collision
        if (checkCollision(player, enemy)) {
            // Stomping from above
            if (player.velY > 0 && player.y + player.height - player.velY <= enemy.y + 5) {
                enemy.alive = false;
                player.velY = -8; // bounce
                // Defeat particles
                for (let i = 0; i < 12; i++) {
                    particles.push({
                        x: enemy.x + enemy.width / 2,
                        y: enemy.y + enemy.height / 2,
                        velX: (Math.random() - 0.5) * 6,
                        velY: (Math.random() - 0.5) * 6,
                        life: 40,
                        color: '#2ecc71'
                    });
                }
            } else {
                // Side collision - game over
                gameOver = true;
            }
        }
    }

    // Win condition
    if (score >= 5 && !enemy.alive) {
        gameWon = true;
    }

    // Update particles
    for (let i = particles.length - 1; i >= 0; i--) {
        particles[i].x += particles[i].velX;
        particles[i].y += particles[i].velY;
        particles[i].life--;
        if (particles[i].life <= 0) {
            particles.splice(i, 1);
        }
    }
}

// ======== DRAW ========
function draw() {
    // Sky gradient
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, '#87CEEB');
    gradient.addColorStop(1, '#E0F6FF');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Clouds
    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
    for (const cloud of clouds) {
        ctx.beginPath();
        ctx.arc(cloud.x, cloud.y, cloud.size, 0, Math.PI * 2);
        ctx.arc(cloud.x + cloud.size * 0.6, cloud.y - cloud.size * 0.3, cloud.size * 0.7, 0, Math.PI * 2);
        ctx.arc(cloud.x + cloud.size * 1.2, cloud.y, cloud.size * 0.8, 0, Math.PI * 2);
        ctx.fill();
    }

    // Platforms
    for (const platform of platforms) {
        ctx.fillStyle = platform.color;
        ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
        if (platform.y < 460) {
            ctx.fillStyle = '#4a752c';
            ctx.fillRect(platform.x, platform.y, platform.width, 5);
        }
    }

    // Ground detail
    ctx.fillStyle = '#5a8a3c';
    for (let x = 0; x < canvas.width; x += 30) {
        ctx.fillRect(x, 455, 15, 5);
    }

    // Coins
    for (const coin of coins) {
        if (!coin.collected) {
            ctx.fillStyle = 'rgba(255, 215, 0, 0.3)';
            ctx.beginPath();
            ctx.arc(coin.x + coin.width / 2, coin.y + coin.height / 2, 12, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(coin.x + coin.width / 2, coin.y + coin.height / 2, 8, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#FFF8DC';
            ctx.beginPath();
            ctx.arc(coin.x + coin.width / 2 - 2, coin.y + coin.height / 2 - 2, 3, 0, Math.PI * 2);
            ctx.fill();
        }
    }

    // Enemy
    if (enemy.alive) {
        // Enemy body
        ctx.fillStyle = enemy.color;
        ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
        // Enemy angry eyes
        ctx.fillStyle = 'white';
        ctx.fillRect(enemy.x + 5, enemy.y + 6, 8, 8);
        ctx.fillRect(enemy.x + 19, enemy.y + 6, 8, 8);
        ctx.fillStyle = '#c0392b';
        ctx.fillRect(enemy.x + 9, enemy.y + 8, 4, 4);
        ctx.fillRect(enemy.x + 23, enemy.y + 8, 4, 4);
        // Angry eyebrows
        ctx.fillStyle = '#1a1a2e';
        ctx.save();
        ctx.translate(enemy.x + 9, enemy.y + 4);
        ctx.rotate(-0.3);
        ctx.fillRect(0, 0, 10, 2);
        ctx.restore();
        ctx.save();
        ctx.translate(enemy.x + 19, enemy.y + 2);
        ctx.rotate(0.3);
        ctx.fillRect(0, 0, 10, 2);
        ctx.restore();
    }

    // Particles
    for (const particle of particles) {
        const alpha = particle.life / 40;
        ctx.fillStyle = particle.color === '#FFD700'
            ? `rgba(255, 215, 0, ${alpha})`
            : `rgba(46, 204, 113, ${alpha})`;
        ctx.fillRect(particle.x - 2, particle.y - 2, 4, 4);
    }

    // Player (cube character)
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.width, player.height);

    // Player eyes
    ctx.fillStyle = 'white';
    ctx.fillRect(player.x + 6, player.y + 8, 8, 8);
    ctx.fillRect(player.x + 18, player.y + 8, 8, 8);
    ctx.fillStyle = '#1a1a2e';
    ctx.fillRect(player.x + 10, player.y + 10, 4, 4);
    ctx.fillRect(player.x + 22, player.y + 10, 4, 4);

    // Score HUD
    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
    ctx.font = 'bold 20px "Courier New", monospace';
    ctx.fillText(`Coins: ${score}/5`, canvas.width - 150, 30);
    ctx.fillStyle = '#FFD700';
    ctx.fillText(`Coins: ${score}/5`, canvas.width - 151, 29);

    // Instructions
    ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
    ctx.font = '14px "Courier New", monospace';
    ctx.fillText('Arrow Keys = Move | Space = Jump | R = Restart', 10, 25);

    // Game Over overlay
    if (gameOver) {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = '#e94560';
        ctx.font = 'bold 60px "Courier New", monospace';
        ctx.textAlign = 'center';
        ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 20);

        ctx.fillStyle = 'white';
        ctx.font = '24px "Courier New", monospace';
        ctx.fillText('Press R to restart', canvas.width / 2, canvas.height / 2 + 30);
        ctx.textAlign = 'left';
    }

    // Win overlay
    if (gameWon) {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = '#2ecc71';
        ctx.font = 'bold 60px "Courier New", monospace';
        ctx.textAlign = 'center';
        ctx.fillText('YOU WIN!', canvas.width / 2, canvas.height / 2 - 20);

        ctx.fillStyle = 'white';
        ctx.font = '24px "Courier New", monospace';
        ctx.fillText('Press R to restart', canvas.width / 2, canvas.height / 2 + 30);
        ctx.textAlign = 'left';
    }
}

// ======== GAME LOOP ========
function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

gameLoop();
    </script>
</body>
</html>
